# Intuition

Each trip request can either be completed or canceled.  
To calculate a **meaningful cancellation rate**, we must only consider trips
where **both the client and the driver are not banned**, since banned users
should not affect platform performance metrics.

The problem requires computing this rate **per day** over a specific date
range, so the key idea is to filter out invalid trips first and then aggregate
the remaining data by date.

---

# Approach

1. **Filter valid trips**
   - Join the `Trips` table with the `Users` table twice:
     - once to validate the **client**
     - once to validate the **driver**
   - Keep only rows where both users are **not banned**.
   - Restrict the data to the required date range.

2. **Count canceled and total trips**
   - Use conditional aggregation:
     - Count canceled trips with a `CASE` expression.
     - Count total trips with `COUNT(*)`.

3. **Compute the cancellation rate**
   - Divide the number of canceled trips by the total number of valid trips.
   - Round the result to **two decimal places**.

4. **Group by day**
   - Aggregate results by `request_at` to get one row per day.

---

# Complexity

- **Time complexity:**  
  $$O(n)$$  
  Each trip is processed once, with constant-time joins and aggregations.

- **Space complexity:**  
  $$O(1)$$  
  No additional data structures are used beyond aggregation variables.

---

# Code

```mysql
SELECT
    t.request_at AS Day,
    ROUND(
        SUM(CASE
                WHEN t.status IN ('cancelled_by_driver', 'cancelled_by_client')
                THEN 1 ELSE 0
            END) / COUNT(*),
        2
    ) AS `Cancellation Rate`
FROM Trips t
JOIN Users c
    ON t.client_id = c.users_id
JOIN Users d
    ON t.driver_id = d.users_id
WHERE
    c.banned = 'No'
    AND d.banned = 'No'
    AND t.request_at BETWEEN '2013-10-01' AND '2013-10-03'
GROUP BY t.request_at;
```
