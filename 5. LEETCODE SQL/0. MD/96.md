# Intuition

Each user can react to many pieces of content using different reaction types.  
To determine whether a user is **emotionally consistent**, we need to check if the majority of their reactions are of the **same type**.

The problem naturally breaks into two questions:

1. How often does each reaction type appear for a user?
2. Does the most frequent reaction account for **at least 60%** of all reactions, with the user having reacted to **at least 5 contents**?

---

# Approach

1. **Count reactions per user and reaction type**
   - Group by `(user_id, reaction)` to get how many times each reaction occurs for a user.

2. **Count total reactions and enforce the minimum activity requirement**
   - Group by `user_id` and keep only users who have reacted to at least **5 different content items**.

3. **Identify the dominant reaction**
   - Use a window function (`ROW_NUMBER`) to rank reactions per user by frequency.
   - The reaction with rank `1` is the dominant reaction for that user.

4. **Compute the reaction ratio**
   - Calculate `reaction_count / total_reactions`.
   - Round the result to **2 decimal places** as required.

5. **Filter and order results**
   - Keep only users whose dominant reaction accounts for **at least 60%** of their reactions.
   - Order by `reaction_ratio` (descending), then by `user_id` (ascending).

---

# Complexity

- **Time complexity:**  
  $$O(n)$$  
  Each reaction record is processed a constant number of times through grouping and window functions.

- **Space complexity:**  
  $$O(n)$$  
  Intermediate CTEs store aggregated results per user and reaction.

---

# Code

```mysql
WITH reaction_counts AS (
    SELECT
        user_id,
        reaction,
        COUNT(*) AS reaction_count
    FROM reactions
    GROUP BY user_id, reaction
),
totals AS (
    SELECT
        user_id,
        COUNT(*) AS total_reactions
    FROM reactions
    GROUP BY user_id
    HAVING COUNT(DISTINCT content_id) >= 5
),
ranked AS (
    SELECT
        rc.user_id,
        rc.reaction AS dominant_reaction,
        rc.reaction_count,
        t.total_reactions,
        ROW_NUMBER() OVER (
            PARTITION BY rc.user_id
            ORDER BY rc.reaction_count DESC
        ) AS rn
    FROM reaction_counts rc
    JOIN totals t
        ON rc.user_id = t.user_id
)
SELECT
    user_id,
    dominant_reaction,
    ROUND(reaction_count * 1.0 / total_reactions, 2) AS reaction_ratio
FROM ranked
WHERE rn = 1
  AND reaction_count * 1.0 / total_reactions >= 0.6
ORDER BY reaction_ratio DESC, user_id ASC;
```
