# ðŸ§  Intuition

A patient is considered **recovered from COVID** only if they:

1. Tested **Positive at least once**, and
2. Later tested **Negative after that positive test**.

The recovery time is defined as the number of days between:

- the **first positive test**, and
- the **first negative test that occurs after the positive**.

Since the order of test dates matters, a simple aggregation is not enough.  
We need to **respect the temporal sequence** of test results for each patient.

---

# ðŸ§© Approach

1. **Identify the first positive test per patient**
   - Filter rows where `result = 'Positive'`
   - Use `MIN(test_date)` grouped by `patient_id`

2. **Find the first negative test after the positive test**
   - Join the COVID tests table with the first-positive results
   - Keep only `Negative` tests where `test_date > positive_date`
   - Use `MIN(test_date)` to get the earliest valid negative test

3. **Compute recovery time**
   - Use `DATEDIFF(negative_date, positive_date)`

4. **Filter valid patients automatically**
   - Inner joins ensure only patients with both a valid positive and a subsequent negative test are included

5. **Sort the result**
   - By `recovery_time` (ascending)
   - Then by `patient_name` (ascending)

---

# â±ï¸ Complexity

- **Time complexity:**  
  $$O(n \log n)$$
  - Aggregations and joins over the `covid_tests` table dominate the cost

- **Space complexity:**  
  $$O(n)$$
  - Intermediate CTEs store per-patient aggregated dates

---

# ðŸ’» Code

```mysql
WITH first_positive AS (
    SELECT
        patient_id,
        MIN(test_date) AS positive_date
    FROM covid_tests
    WHERE result = 'Positive'
    GROUP BY patient_id
),
first_negative_after_positive AS (
    SELECT
        c.patient_id,
        MIN(c.test_date) AS negative_date
    FROM covid_tests c
    JOIN first_positive fp
        ON c.patient_id = fp.patient_id
       AND c.test_date > fp.positive_date
    WHERE c.result = 'Negative'
    GROUP BY c.patient_id
)
SELECT
    p.patient_id,
    p.patient_name,
    p.age,
    DATEDIFF(fn.negative_date, fp.positive_date) AS recovery_time
FROM first_positive fp
JOIN first_negative_after_positive fn
    ON fp.patient_id = fn.patient_id
JOIN patients p
    ON p.patient_id = fp.patient_id
ORDER BY recovery_time ASC, p.patient_name ASC;
```
