# üß† Intuition

The problem asks for the **most popular product category in each season**.  
Popularity is not just a simple count ‚Äî it follows a **hierarchy of rules**:

1. Highest **total quantity sold** in that season
2. If tied, highest **total revenue**
3. If still tied, **lexicographically smallest category**

This immediately suggests:

- We must **aggregate sales by season and category**
- Then **rank categories within each season** using the given tie-breaking rules
- Finally, select the **top-ranked category per season**

Because ‚Äúmost popular per season‚Äù is required, simple `GROUP BY` is not enough ‚Äî we need **window functions**.

---

# üß© Approach

1. **Map each sale to a season** using `MONTH(sale_date)`:
   - Winter ‚Üí Dec, Jan, Feb
   - Spring ‚Üí Mar, Apr, May
   - Summer ‚Üí Jun, Jul, Aug
   - Fall ‚Üí Sep, Oct, Nov

2. **Join** the `sales` table with the `products` table to get the product category.

3. **Aggregate** data by `(season, category)` to compute:
   - `total_quantity` ‚Üí `SUM(quantity)`
   - `total_revenue` ‚Üí `SUM(quantity √ó price)`

4. Use a **window function (`ROW_NUMBER`)** to rank categories **within each season**, ordered by:
   - `total_quantity DESC`
   - `total_revenue DESC`
   - `category ASC` (lexicographical tie-breaker)

5. **Filter** to keep only the top-ranked category (`rn = 1`) for each season.

6. **Order the final output** by season in ascending seasonal order:
   Fall ‚Üí Spring ‚Üí Summer ‚Üí Winter.

---

# ‚è±Ô∏è Complexity

- **Time complexity:**  
  $$O(n \log n)$$
  - Aggregation scans all sales rows: `O(n)`
  - Window function sorting per season adds the `log` factor

- **Space complexity:**  
  $$O(k)$$
  - Where `k` is the number of `(season, category)` combinations stored in intermediate CTEs

---

# üíª Code

```mysql
WITH season_category_sales AS (
    SELECT
        CASE
            WHEN MONTH(s.sale_date) IN (12, 1, 2) THEN 'Winter'
            WHEN MONTH(s.sale_date) BETWEEN 3 AND 5 THEN 'Spring'
            WHEN MONTH(s.sale_date) BETWEEN 6 AND 8 THEN 'Summer'
            WHEN MONTH(s.sale_date) BETWEEN 9 AND 11 THEN 'Fall'
        END AS season,
        p.category,
        SUM(s.quantity) AS total_quantity,
        SUM(s.quantity * s.price) AS total_revenue
    FROM sales s
    JOIN products p
        ON s.product_id = p.product_id
    GROUP BY season, p.category
),
ranked AS (
    SELECT *,
        ROW_NUMBER() OVER (
            PARTITION BY season
            ORDER BY
                total_quantity DESC,
                total_revenue DESC,
                category ASC
        ) AS rn
    FROM season_category_sales
)
SELECT
    season,
    category,
    total_quantity,
    total_revenue
FROM ranked
WHERE rn = 1
ORDER BY
    CASE season
        WHEN 'Fall' THEN 1
        WHEN 'Spring' THEN 2
        WHEN 'Summer' THEN 3
        WHEN 'Winter' THEN 4
    END;
```
