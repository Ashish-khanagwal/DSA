# Intuition

Each process on a machine has exactly one `start` and one `end` timestamp.  
The time taken by a process is simply:

```
end_timestamp − start_timestamp
```

To find the **average processing time per machine**, we must first calculate the
time taken for each individual process and then average those times for each
machine.

---

# Approach

1. **Pair start and end timestamps per process**
   - Group by `(machine_id, process_id)`
   - Use conditional aggregation to extract the `start` and `end` timestamps

2. **Compute processing time per process**
   - Subtract `start_time` from `end_time`

3. **Compute average per machine**
   - Group by `machine_id`
   - Take the average of all process times
   - Round the result to 3 decimal places as required

---

# Complexity

- **Time Complexity:**  
  $$O(n)$$ — each activity record is processed once.

- **Space Complexity:**  
  $$O(n)$$ — an intermediate grouped result is created for each process.

---

# Code

```sql
SELECT
    machine_id,
    ROUND(
        AVG(end_time - start_time),
        3
    ) AS processing_time
FROM (
    SELECT
        machine_id,
        process_id,
        MAX(CASE WHEN activity_type = 'end' THEN timestamp END) AS end_time,
        MAX(CASE WHEN activity_type = 'start' THEN timestamp END) AS start_time
    FROM Activity
    GROUP BY machine_id, process_id
) t
GROUP BY machine_id;
```
