# Intuition

Each driver may have multiple trips throughout the year.  
To determine whether a driver’s fuel efficiency has **improved**, we need to compare their **average fuel efficiency** in the first half of the year with the second half.

Fuel efficiency must be calculated **per trip** (`distance_km / fuel_consumed`) and then averaged separately for each half of the year.  
Only drivers who have trips in **both halves** and show a **positive improvement** should be included.

---

# Approach

1. **Compute per-half averages**
   - Use conditional aggregation with `AVG(CASE WHEN …)` to calculate:
     - `first_half_avg` for trips between January and June
     - `second_half_avg` for trips between July and December

2. **Ensure trips exist in both halves**
   - Use `HAVING` with conditional `COUNT` to keep only drivers who have at least one trip in each half of the year.

3. **Calculate improvement**
   - Compute efficiency improvement as:
     ```
     second_half_avg − first_half_avg
     ```
   - Round all reported values to **2 decimal places**.

4. **Filter and order**
   - Keep only drivers whose efficiency has improved (`second_half_avg > first_half_avg`).
   - Order results by efficiency improvement (descending), then by driver name (ascending).

---

# Complexity

- **Time complexity:**  
  $$O(n)$$  
  Each trip record is processed once during aggregation.

- **Space complexity:**  
  $$O(n)$$  
  Temporary space is used for aggregated results per driver.

---

# Code

```mysql
WITH half_avg AS (
    SELECT
        t.driver_id,
        AVG(CASE
                WHEN t.trip_date BETWEEN '2023-01-01' AND '2023-06-30'
                THEN t.distance_km / t.fuel_consumed
            END) AS first_half_avg,
        AVG(CASE
                WHEN t.trip_date BETWEEN '2023-07-01' AND '2023-12-31'
                THEN t.distance_km / t.fuel_consumed
            END) AS second_half_avg
    FROM trips t
    GROUP BY t.driver_id
    HAVING
        COUNT(CASE
                  WHEN t.trip_date BETWEEN '2023-01-01' AND '2023-06-30'
                  THEN 1
              END) > 0
    AND
        COUNT(CASE
                  WHEN t.trip_date BETWEEN '2023-07-01' AND '2023-12-31'
```
