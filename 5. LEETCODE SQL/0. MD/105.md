# Intuition

The problem requires transforming text **based on character context**, not just word-level splitting.  
Each letter must be converted to lowercase by default, but **capitalized if it starts a word**.  
A word start is defined as:

- The **first character of the string**
- Any character that **follows a space**
- Any character that **follows a hyphen (`-`)**

Because capitalization depends on the **previous character**, a simple regex or string split is not reliable.  
This makes a **character-by-character traversal** the most accurate approach.

---

# Approach

1. **Traverse the string one character at a time**  
   Use a recursive CTE to iterate through each character position of `content_text`.

2. **Normalize case**  
   Convert every character to lowercase first to ensure consistent formatting.

3. **Apply capitalization rules**  
   Capitalize the character if:
   - It is the first character of the string, or
   - The previous character is a space `' '`, or
   - The previous character is a hyphen `'-'`

4. **Reconstruct the transformed string**  
   Use `STRING_AGG` ordered by character position to rebuild the final result.

5. **Return required output**  
   Include both the original text and the transformed text, preserving spacing and formatting.

---

# Complexity

- **Time complexity:**  
  $$O(n)$$  
  Each character in the input is processed exactly once.

- **Space complexity:**  
  $$O(n)$$  
  The recursive CTE stores intermediate characters before reconstruction.

---

# Code

```postgresql
WITH RECURSIVE chars AS (
    SELECT
        content_id,
        content_text,
        1 AS pos,
        LENGTH(content_text) AS len,
        LOWER(SUBSTRING(content_text FROM 1 FOR 1)) AS ch,
        NULL::text AS prev_ch
    FROM user_content

    UNION ALL

    SELECT
        content_id,
        content_text,
        pos + 1,
        len,
        LOWER(SUBSTRING(content_text FROM pos + 1 FOR 1)) AS ch,
        SUBSTRING(content_text FROM pos FOR 1) AS prev_ch
    FROM chars
    WHERE pos < len
),
rebuilt AS (
    SELECT
        content_id,
        content_text,
        pos,
        CASE
            WHEN pos = 1
              OR prev_ch = ' '
              OR prev_ch = '-'
            THEN UPPER(ch)
            ELSE ch
        END AS final_ch
    FROM chars
)
SELECT
    content_id,
    content_text AS original_text,
    STRING_AGG(final_ch, '' ORDER BY pos) AS converted_text
FROM rebuilt
GROUP BY content_id, content_text
ORDER BY content_id;
```
