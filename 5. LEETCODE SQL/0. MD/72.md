# Intuition

Each stock can be bought and sold multiple times at different prices.  
To calculate the **capital gain or loss**, we need to:

- Add up all the **selling prices**
- Add up all the **buying prices**
- Subtract total buying from total selling

This ensures we account for every transaction related to a stock.

---

# Approach

1. Group records by `stock_name` so each stock is handled independently.
2. Use conditional aggregation with `CASE`:
   - Sum prices where the operation is `Sell`
   - Sum prices where the operation is `Buy`
3. Subtract total buy price from total sell price to get the final **capital gain or loss** for each stock.

---

# Complexity

- **Time Complexity:**  
  $$O(n)$$ — each transaction is processed once.

- **Space Complexity:**  
  $$O(1)$$ — only constant extra space is used for aggregation.

---

# Code

```sql
SELECT stock_name,
    SUM(CASE WHEN operation = 'Sell' THEN price ELSE 0 END) -
    SUM(CASE WHEN operation = 'Buy'  THEN price ELSE 0 END) AS capital_gain_loss
FROM Stocks
GROUP BY stock_name;
```
