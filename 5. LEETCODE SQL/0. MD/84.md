# ðŸ§  Intuition

The goal is to identify **books with polarized opinions**, meaning that readers strongly disagree about them.  
A polarized book must:

- Receive **both very high (â‰¥ 4)** and **very low (â‰¤ 2)** ratings.
- Have **enough data** (at least 5 reading sessions) to make the conclusion meaningful.

Rather than filtering individual rows, the correct approach is to **aggregate all reading sessions per book**, compute summary statistics, and then apply the polarization rules on the aggregated results.

---

# ðŸ§© Approach

1. **Join the tables**
   - Join `books` with `reading_sessions` using `book_id` to associate ratings with each book.

2. **Aggregate per book**
   - Group by book attributes so that each row in the result represents one book.

3. **Compute required metrics**
   - **Rating spread**:
     ```
     MAX(session_rating) - MIN(session_rating)
     ```
   - **Polarization score**:
     - Count extreme ratings (`â‰¤ 2` or `â‰¥ 4`) using `CASE`.
     - Divide by total number of sessions.
     - Use floating-point division to avoid integer truncation.

4. **Apply qualification rules in `HAVING`**
   - At least **5 sessions**.
   - At least **one high rating** and **one low rating**.
   - **Polarization score â‰¥ 0.6**.

5. **Order the results**
   - First by `polarization_score` in descending order.
   - Then by `title` in descending order.

---

# â±ï¸ Complexity

- **Time complexity:**  
  $$O(n)$$  
  Each reading session is processed once during aggregation.

- **Space complexity:**  
  $$O(k)$$  
  Where `k` is the number of distinct books stored in the grouped result.

---

# Code

```mysql []
SELECT
    b.book_id,
    b.title,
    b.author,
    b.genre,
    b.pages,
    MAX(r.session_rating) - MIN(r.session_rating) AS rating_spread,
    ROUND(
        SUM(
            CASE
                WHEN r.session_rating >= 4
                  OR r.session_rating <= 2
                THEN 1
                ELSE 0
            END
        ) * 1.0 / COUNT(*),
        2
    ) AS polarization_score
FROM books b
JOIN reading_sessions r
    ON b.book_id = r.book_id
GROUP BY
    b.book_id, b.title, b.author, b.genre, b.pages
HAVING
    COUNT(*) >= 5
    AND MAX(CASE WHEN r.session_rating >= 4 THEN 1 ELSE 0 END) = 1
    AND MAX(CASE WHEN r.session_rating <= 2 THEN 1 ELSE 0 END) = 1
    AND (
        SUM(
            CASE
                WHEN r.session_rating >= 4
                  OR r.session_rating <= 2
                THEN 1
                ELSE 0
            END
        ) * 1.0 / COUNT(*)
    ) >= 0.6
ORDER BY
    polarization_score DESC,
    title DESC;

```
