# Intuition

Each employee can belong to one or more departments.  
If an employee belongs to **only one department**, that department should be reported even though `primary_flag = 'N'`.  
If an employee belongs to **multiple departments**, only the department marked with `primary_flag = 'Y'` should be reported.

So the key idea is:

- First, determine **how many departments** each employee belongs to.
- Then, based on that count, decide **which row to keep**.

---

# Approach

1. **Count departments per employee**
   - Use a window function `COUNT(*) OVER (PARTITION BY employee_id)` to compute how many departments each employee is associated with.
   - This avoids collapsing rows with `GROUP BY`.

2. **Apply CASE logic**
   - If `dept_count = 1`, select that department (only department case).
   - If `dept_count > 1`, select the row where `primary_flag = 'Y'`.

3. **Filter rows**
   - The `CASE` expression is used in the `WHERE` clause to keep only valid rows that represent the primary (or only) department.

---

# Complexity

- **Time complexity:**  
  $$O(n)$$  
  Each row is scanned once, and the window function runs in linear time.

- **Space complexity:**  
  $$O(n)$$  
  Extra space is used internally for the window function result.

---

# Code

```mysql
SELECT
    employee_id,
    department_id
FROM (
    SELECT
        employee_id,
        department_id,
        primary_flag,
        COUNT(*) OVER (PARTITION BY employee_id) AS dept_count
    FROM Employee
) t
WHERE
    CASE
        WHEN dept_count = 1 THEN department_id
        WHEN dept_count > 1 AND primary_flag = 'Y' THEN department_id
        ELSE 0
    END;
```
