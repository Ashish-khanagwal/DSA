# Intuition

Each row in the `app_events` table represents a single user action within a session.  
Since a _zombie session_ is defined by **session-level behavior**, the key idea is to **aggregate events by `session_id` and `user_id`** and then evaluate the required conditions using those aggregates.

The problem naturally breaks down into:

- Measuring how long each session lasts
- Counting different types of events per session
- Applying the given rules using aggregate filters

---

# Approach

1. **Group events by `session_id` and `user_id`**  
   This allows us to analyze behavior at the session level.

2. **Compute session duration**  
   Use `MIN(event_timestamp)` and `MAX(event_timestamp)` and calculate the difference in minutes using `TIMESTAMPDIFF`.

3. **Count relevant events**
   - Scroll events using `SUM(event_type = 'scroll')`
   - Click events using `SUM(event_type = 'click')`
   - Purchase events using `SUM(event_type = 'purchase')`

4. **Apply zombie session criteria in the `HAVING` clause**
   - Session duration greater than 30 minutes
   - At least 5 scroll events
   - Click-to-scroll ratio strictly less than 0.20
   - No purchase events in the session

5. **Sort the results**  
   Order by `scroll_count` in descending order and `session_id` in ascending order, as required.

---

# Complexity

- **Time complexity:**  
  $$O(n)$$  
  Each event is processed once during aggregation.

- **Space complexity:**  
  $$O(s)$$  
  Where \( s \) is the number of distinct sessions, since aggregates are stored per session.

---

# Code

```mysql
SELECT
    session_id,
    user_id,
    TIMESTAMPDIFF(
        MINUTE,
        MIN(event_timestamp),
        MAX(event_timestamp)
    ) AS session_duration_minutes,
    SUM(event_type = 'scroll') AS scroll_count
FROM app_events
GROUP BY session_id, user_id
HAVING
    session_duration_minutes > 30
    AND scroll_count >= 5
    AND SUM(event_type = 'click') / scroll_count < 0.20
    AND SUM(event_type = 'purchase') = 0
ORDER BY
    scroll_count DESC,
    session_id ASC;
```
